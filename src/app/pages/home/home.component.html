<app-hero-slider></app-hero-slider>

<section class="py-16 md:py-24 bg-white overflow-hidden">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <ng-container *ngIf="settings$ | async as settings; else loadingSettings">
      <div class="flex flex-col lg:flex-row items-center gap-12">
        <div class="w-full lg:w-1/2 relative group">
          <div class="absolute -inset-4 bg-blue-100 rounded-xl transform -rotate-2 transition-transform group-hover:rotate-0"></div>
          <img src="https://pplx-res.cloudinary.com/image/upload/v1765513253/search_images/1ae70ea58b03bdb7ef99b684e9f870dd1c50316a.jpg" 
               alt="Kyranis Park Présentation" 
               class="relative rounded-lg shadow-2xl w-full h-[400px] object-cover transition-transform duration-500 hover:scale-[1.02]">
        </div>
        <div class="w-full lg:w-1/2">
          <h2 class="text-blue-600 font-semibold tracking-wide uppercase text-sm mb-2">Bienvenue à Kerkennah</h2>
          <h3 class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">Découvrez {{ settings.businessName || 'Kyranis Park' }}</h3>
          <div class="text-gray-600 text-lg leading-relaxed mb-8 whitespace-pre-wrap font-light">
            {{ settings.homePageDescription || 'Un lieu unique où la nature rencontre le confort.\nProfitez de nos excursions en mer et de notre espace événementiel.' }}
          </div>
          <div class="flex flex-col sm:flex-row gap-4">
            <a routerLink="/reservations" class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors text-center">
              Réserver Maintenant
            </a>
            <a routerLink="/contact" class="px-8 py-3 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:border-blue-600 hover:text-blue-600 transition-colors text-center">
              Nous Contacter
            </a>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-template #loadingSettings>
      <div class="animate-pulse flex space-x-4 h-64 items-center justify-center">
        <div class="text-gray-400">Chargement...</div>
      </div>
    </ng-template>
  </div>
</section>

<section class="py-16 bg-blue-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row justify-between items-end mb-12">
      <div class="text-center md:text-left">
        <h2 class="text-3xl font-bold text-gray-900">À la une</h2>
        <p class="mt-4 text-gray-600">Nos prochains événements à ne pas manquer</p>
      </div>
      <a routerLink="/evenements" class="hidden md:inline-flex items-center text-blue-600 font-semibold hover:text-blue-800 transition-colors mt-4 md:mt-0">
        Voir tout l'agenda <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
      </a>
    </div>

    <ng-container *ngIf="upcomingEvents$ | async as events">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div *ngFor="let event of events" class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 group flex flex-col h-full">
          <div class="relative h-48 overflow-hidden">
            <img [src]="getCoverImage(event)" [alt]="event.title" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
            <div class="absolute top-3 left-3 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded shadow">
              {{ event.date | date:'dd MMM' }}
            </div>
          </div>
          <div class="p-6 flex flex-col flex-grow">
            <div class="text-xs text-gray-500 mb-2 uppercase tracking-wide flex items-center">
              <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>
              {{ event.location }}
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">
              {{ event.title }}
            </h3>
            <p class="text-gray-600 text-sm line-clamp-2 mb-4 flex-grow">
              {{ event.description }}
            </p>
            <a routerLink="/evenements" class="text-blue-600 font-medium text-sm hover:underline mt-auto">En savoir plus &rarr;</a>
          </div>
        </div>
      </div>

      <div *ngIf="events.length === 0" class="text-center py-10 bg-white rounded-lg shadow-sm border border-gray-100">
        <p class="text-gray-500">Aucun événement prévu prochainement.</p>
        <a routerLink="/contact" class="text-blue-600 font-semibold text-sm mt-2 inline-block">Organiser le vôtre ?</a>
      </div>
      
      <div class="text-center mt-8 md:hidden">
         <a routerLink="/evenements" class="inline-flex items-center text-blue-600 font-semibold hover:text-blue-800 transition-colors">
          Voir tout l'agenda <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
        </a>
      </div>
    </ng-container>
  </div>
</section>

<section class="py-16 bg-white border-t border-gray-100">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold text-gray-900">Nos Galeries</h2>
      <p class="mt-4 text-gray-600">Découvrez nos albums photos par thématique</p>
    </div>

    <ng-container *ngIf="parkGalleries$ | async as galleries">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <div *ngFor="let gallery of galleries" 
             class="group cursor-pointer bg-gray-50 rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1"
             (click)="openGallery(gallery)">
          <div class="relative h-64 overflow-hidden">
            <img *ngIf="gallery.images && gallery.images.length > 0"
                 [src]="gallery.images[0]" 
                 class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" 
                 [alt]="gallery.name">
            <div *ngIf="!gallery.images || gallery.images.length === 0" 
                 class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400">
               <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            </div>
            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-colors"></div>
            <div class="absolute top-4 right-4 bg-black/60 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">
              {{ gallery.images.length }} Photos
            </div>
          </div>
          <div class="p-6 relative">
            <h3 class="text-xl font-bold text-gray-800 group-hover:text-blue-600 transition-colors">
              {{ gallery.name }}
            </h3>
            <p class="text-sm text-gray-500 mt-2 flex items-center">
              <span class="text-blue-500 mr-2">Voir l'album</span>
              <svg class="w-4 h-4 text-blue-500 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
            </p>
          </div>
        </div>
      </div>
      <div *ngIf="galleries.length === 0" class="text-center text-gray-500 py-10">
        Aucun album disponible.
      </div>
    </ng-container>
  </div>
</section>

<section class="py-16 bg-blue-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h2 class="text-3xl font-bold text-center text-gray-900 mb-12">Ce que disent nos visiteurs</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div *ngFor="let temoignage of testimonials" class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
        <div class="flex text-yellow-400 mb-4">
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <svg *ngIf="star <= temoignage.rating" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          </ng-container>
        </div>
        <p class="text-gray-600 italic mb-6">"{{ temoignage.text }}"</p>
        <div>
          <h4 class="font-bold text-gray-900">{{ temoignage.name }}</h4>
          <span class="text-sm text-gray-500">{{ temoignage.role }}</span>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="py-20 bg-gradient-to-r from-blue-900 to-blue-700 text-center text-white">
  <div class="max-w-4xl mx-auto px-4">
    <h2 class="text-3xl md:text-5xl font-bold mb-6">Prêt pour l'aventure ?</h2>
    <p class="text-xl text-blue-100 mb-10 max-w-2xl mx-auto">
      Que ce soit pour une journée en mer ou une soirée privée, réservez votre moment d'exception dès aujourd'hui.
    </p>
    <div class="flex flex-col sm:flex-row justify-center gap-4">
      <a routerLink="/reservations" [queryParams]="{type: 'boat'}" class="px-8 py-4 bg-white text-blue-900 font-bold rounded-lg hover:bg-gray-100 transition-colors shadow-lg">
        Réserver un Bateau
      </a>
      <a routerLink="/reservations" [queryParams]="{type: 'park'}" class="px-8 py-4 border-2 border-white text-white font-bold rounded-lg hover:bg-white/10 transition-colors">
        Réserver l'Espace Privé
      </a>
    </div>
  </div>
</section>

<div *ngIf="lightboxOpen && selectedGallery" 
     class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-4 transition-opacity duration-300"
     (click)="closeLightbox()">
  <button class="absolute top-4 right-4 text-white hover:text-gray-300 p-2 z-[110]" (click)="closeLightbox()">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>
  <button *ngIf="selectedGallery.images.length > 1"
          class="absolute left-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white p-4 z-[110] hidden md:block hover:bg-black/20 rounded-full transition-all" 
          (click)="prevImage($event)">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
  </button>
  <button *ngIf="selectedGallery.images.length > 1"
          class="absolute right-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white p-4 z-[110] hidden md:block hover:bg-black/20 rounded-full transition-all" 
          (click)="nextImage($event)">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
    </svg>
  </button>
  <div class="relative max-w-7xl w-full h-full flex flex-col items-center justify-center" (click)="$event.stopPropagation()">
    <img [src]="selectedGallery.images[currentImageIndex]" 
         alt="Gallery Image" 
         class="max-w-full max-h-[85vh] object-contain rounded-md shadow-2xl animate-fade-in select-none">
    <div class="absolute bottom-4 left-0 right-0 text-center text-white/80 pointer-events-none">
      <p class="text-lg font-bold mb-1">{{ selectedGallery.name }}</p>
      <p class="text-sm">{{ currentImageIndex + 1 }} / {{ selectedGallery.images.length }}</p>
    </div>
  </div>
</div>
